<!-- TODO -> Section / Field preview and icons -->
<div *ngIf="builderForm" class="container">
  <aside class="toolbox">
    <div
      [id]="toolBoxGroupId"
      cdkDropList
      [cdkDropListConnectedTo]="[formSections]"
    >
      <div
        class="toolbox-element"
        *ngFor="let groupType of groupTypes"
        cdkDrag
        [cdkDragData]="groupType.value"
      >
        Form {{ groupType.display }}
      </div>
    </div>
    <div
      [id]="toolBoxFieldId"
      cdkDropList
      [cdkDropListConnectedTo]="dropListIds"
    >
      <div
        class="toolbox-element"
        *ngFor="let field of fieldTypes"
        cdkDrag
        [cdkDragData]="field.value"
      >
        {{ field.display }} Element
      </div>
    </div>
  </aside>

  <mat-divider [vertical]="true"></mat-divider>

  <section class="form-builder">
    <form [formGroup]="builderForm" (ngSubmit)="onSubmit(builderForm)">
      <div formGroupName="config">
        <div class="form-config">
          <uqt-form-builder-header
            [name]="builderForm.value.config.formName"
            (toggleConfig)="toggleFormConfig()"
          ></uqt-form-builder-header>

          <uqt-form-builder-config *ngIf="showFormConfig" [form]="builderForm">
          </uqt-form-builder-config>

          <mat-divider></mat-divider>
        </div>
        <div
          class="form-sections"
          formArrayName="structure"
          cdkDropList
          #formSections="cdkDropList"
          (cdkDropListDropped)="formGroupDropped($event)"
        >
          <mat-card
            cdkDrag
            class="group-section"
            *ngFor="let group of structure.controls; let i = index"
          >
            <div [formGroupName]="i">
              <div class="group-settings">
                <mat-form-field>
                  <mat-label>Section Name</mat-label>
                  <input matInput type="text" formControlName="groupName" />
                </mat-form-field>

                <button
                  mat-icon-button
                  type="button"
                  (click)="deleteFormGroup(i)"
                >
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
              <mat-divider [inset]="true"></mat-divider>

              <div
                [id]="'fields-' + i"
                class="group-fields"
                formArrayName="fields"
                cdkDropList
                [cdkDropListConnectedTo]="dropListIds"
                (cdkDropListDropped)="formFieldDropped($event)"
              >
                <div
                  class="group-form-field"
                  cdkDrag
                  *ngFor="
                    let field of getGroupFields(i).controls;
                    let idx = index
                  "
                >
                  <div class="group-form-field-header">
                    <p>{{ field.value.type }}: {{ field.value.label }}</p>
                    <span>
                      <button
                        mat-icon-button
                        type="button"
                        (click)="showFormField(i, idx)"
                      >
                        <mat-icon>expand_more</mat-icon>
                      </button>

                      <button
                        mat-icon-button
                        type="button"
                        (click)="removeGroupField(i, idx)"
                      >
                        <mat-icon>clear</mat-icon>
                      </button>
                    </span>
                  </div>

                  <div
                    *ngIf="
                      fieldVisible.groupIndex === i &&
                      fieldVisible.fieldIndex === idx
                    "
                    [formGroupName]="idx"
                    class="edit-field"
                  >
                    <mat-form-field appearance="outline">
                      <mat-label>Field Label (display)</mat-label>
                      <input matInput type="text" formControlName="label" />
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                      <mat-label>Field Name</mat-label>
                      <input matInput type="text" formControlName="name" />
                    </mat-form-field>
                  </div>
                </div>
              </div>
            </div>
          </mat-card>
        </div>
      </div>
    </form>
  </section>
</div>
