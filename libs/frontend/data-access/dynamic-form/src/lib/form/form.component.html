<form
  *ngIf="structure$ | async as structure"
  class="dynamic-form"
  [formGroup]="form"
  autocomplete="off"
  (ngSubmit)="onSubmit(form)"
  [@.disabled]="!(config$ | async).animations"
>
  <ng-container *ngFor="let group of structure; let idx = index">
    <ng-container *ngIf="(formIdx$ | async) === idx">
      <section
        *ngIf="group.type === 'GROUP'; else arrayGroup"
        [formGroupName]="group.name"
        @centerExpand
      >
        <ng-container
          *ngFor="let field of group.fields"
          dynamicFormField
          [field]="field"
          [type]="group.type"
          [group]="getFormGroup(group.name)"
        >
        </ng-container>
      </section>

      <ng-template #arrayGroup>
        <section [formArrayName]="group.name" @centerExpand>
          <ng-container
            *ngFor="
              let field of getArrayGroup(group.name).controls;
              let i = index
            "
            dynamicFormField
            [idx]="i"
            [type]="group.type"
            [field]="group.field"
            [group]="getArrayGroup(group.name)"
          >
          </ng-container>
        </section>
      </ng-template>
    </ng-container>
  </ng-container>

  <div class="action-buttons">
    <button
      *ngIf="(structure$ | async).length > 1"
      type="button"
      class="nav-button"
      mat-icon-button
      [disabled]="(formIdx$ | async) <= 0"
      (click)="backASection()"
    >
      <mat-icon>navigate_before</mat-icon>
    </button>

    <button
      *ngIf="(structure$ | async).length > 1"
      type="button"
      class="nav-button"
      mat-icon-button
      [disabled]="(formIdx$ | async) >= structure.length - 1"
      (click)="nextSection()"
    >
      <mat-icon>navigate_next</mat-icon>
    </button>
  </div>

  <ng-content class="select-button" select='button[type="submit"]'></ng-content>
  <ng-content class="select-button" select='button[type="reset"]'></ng-content>
</form>

<ng-container appFormErrors> </ng-container>
